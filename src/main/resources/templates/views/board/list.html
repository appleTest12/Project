<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<head>
	<meta charset="UTF-8">
	<title>게시판</title>
	
	<!-- ✅ 추가 -->
	<link type="text/css" href="/css/style.css" rel="stylesheet">
	<script type="text/javascript" src="/js/com-ajax.js"></script>
	<script type="text/javascript" src="/js/com-page.js"></script>
</head>
<script type="text/javascript">

	// 페이지 온로드시 게시글 목록 조회
	window.onload = function () {
		getList();
	}

	// 게시글 목록 조회
	function getList(pageNo) {
		
		// ✅ 페이지번호 추가 
		pageNo = pageNo || 0;
		
		const title = document.querySelector("#title").value;
		const writer = document.querySelector("#writer").value;
		
		// ✅ 파라미터 전달시에도 추가
		const data = "?title=" + title + "&writer=" + writer + "&page=" + pageNo;
		
		AJAX.ajaxCall("GET", "/boards", data, afterGetList);
	}
	
	// 조회 후 처리
	function afterGetList(response) {
		
		// ✅ 페이징 처리
		PAGE.paging(response.totalPages, response.number, response.totalElements, "getList");
		
		// 결과 테이블 생성
		resultTable(response);
	}

	// 동적으로 테이블 생성
	function resultTable(response) {
		document.querySelector("#fieldListBody").innerHTML = "";
		
		if (response.size > 0) {
			const content = response.content;
			
			// ✅ 반복문 변경 (Pageable 결과값을 기준으로 값 가져오기 위함)
			for (var i = 0; i < content.length; i++) {
				let element = document.querySelector("#fieldListBody");
				
				let result = content[i];
				let template = `
					<td><p>${PAGE.pageRowNumber(response.number, response.size, i, response.totalElements)}</p></td>
					<td><a href="/detail?id=${result.boardId}">${result.title}</a></td>
					<td><p>${result.writer}</p></td>
					<td><p>${result.regDate}</p></td>
				`;
				element.insertAdjacentHTML('beforeend', template);
			}
		}
	}
	
	// 초기화
	function resetList() {
		document.querySelector("#title").value = "";
		document.querySelector("#writer").value = "";
		document.querySelector("#fieldListBody").innerHTML = "";
		
		getList();
	}
	
	function fn_AddWrite() {
		location.href="/write";
	}
</script>
<body>
	<div>
		<h2>게시판 목록</h2>
		<table>
			<tr>
				<th>제목</th>
				<td><input type="text" id="title"></td>
			</tr>
			<tr>
				<th>작성자</th>
				<td><input type="text" id="writer"></td>
			</tr>
			<tr>
				<td><button onclick="fn_AddWrite()">등록</button></td>
				<td><button onclick="getList()">조회</button></td>
				<td><button onclick="resetList()">초기화</button></td>
			</tr>
		</table>
		<!-- ✅ 페이지 요소 추가 -->
		<input type="hidden" name="page" id="page" value="0" />
	</div>
	<div>
		<table class="table table-boarderd table-hover boardlist">
			<colgroup>
				<col width="10%">
				<col width="50%">
				<col width="15%">
				<col width="15%">
			</colgroup>
			<thead>
				<!-- 테이블의 하나의 행을 말함(한 줄)-->
			    <tr>
			    	<!-- 게시판의 속성을 하나씩 명시 해준다. -->
			        <th style="background-color:#eeeeee; text-align:center;">번호</th>
			        <th style="background-color:#eeeeee; text-align:center;">제목</th>
			        <th style="background-color:#eeeeee; text-align:center;">작성자</th>
			        <th style="background-color:#eeeeee; text-align:center;">작성일</th>
			    </tr>
			</thead>
			<tbody>
			<tbody id="fieldListBody">	
			</tbody>
		</table>
		<!-- ✅ 페이징 표시되는 부분 추가 -->
		<ul id = "pagingArea" class="pagination"></ul>
	</div>
</body>
</html>