<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시물 수정폼</title>
	<script type="text/javascript" src="/js/com-ajax.js"></script>
</head>
<style>
    .layout {
        width: 500px;
        margin: 0 auto;
    }

    .layout input {
        width: 100%;
        box-sizing: border-box;
    }

    .layout textarea {
        width: 100%;
        margin-top: 10px;
        min-height: 300px;
    }
</style>
<script>
	// 페이지 온로드시 게시글 목록 조회
	window.onload = function () {
		fn_detail();
		const boardId = document.getElementById("boardId").value;
		document.getElementById('back_btn').setAttribute('href', "/detail?id="+boardId)
	}

	// 게시글 목록 조회
	function fn_detail() {
		const boardId = document.getElementById("boardId").value;
		const data = "?boardId="+boardId;
		AJAX.ajaxCall("GET", "/boards/detail", data, fn_Rtn);
	}
	
	function fn_Rtn(res){
		let element = document.querySelector("#fieldListBody");
		document.getElementById("title").value = res.content[0].title
		document.getElementById("content").value = res.content[0].content
	}
	
	function fn_update(){
		const boardId = document.getElementById("boardId").value;
		const title = document.getElementById("title").value;
		const content = document.getElementById("content").value;
		const data = "?boardId="+boardId+"&title="+title+"&content="+content;
		AJAX.ajaxCall("GET", "/boards/update", data, fn_updateRtn);
	}
	
	function fn_updateRtn(res){
		if(res){
			alert("수정되었습니다.");
			const boardId = document.getElementById("boardId").value;
			location.href="/detail?id="+boardId;
		} else {
			alert("실패하였습니다.");
		}
	}
</script>
<body>
    <div class="layout">
		<input type="hidden" id="boardId" th:value="${param.id}"/>
        <input name="title" type="text" id="title"><br>
        <textarea name="content" id="content"></textarea> <br>
        <button type="submit" onclick="fn_update()">수정</button>
		<button><a type="submit" id="back_btn">뒤로가기</a></button>
    </div>
</body>
</html>